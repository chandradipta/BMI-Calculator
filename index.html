<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BMI Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous"></script>
  <style>
    body{font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial;}
    .bmi-bar{height:16px;border-radius:9999px;background:linear-gradient(to right,#60a5fa 0%,#22c55e 46.25%,#facc15 74.75%,#ef4444 100%);position:relative;overflow:hidden;}
    .indicator{width:18px;height:18px;border-radius:9999px;background:#111827;position:absolute;top:-1px;transform:translateX(-50%);transition:left .8s ease-in-out;animation:bob 1.1s ease-in-out infinite alternate;box-shadow:0 0 0 2px rgba(255,255,255,.6);}
    .dark .indicator{background:#fff;box-shadow:0 0 0 2px rgba(0,0,0,.5);}
    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
    @keyframes bob{from{transform:translate(-50%,-1px)}to{transform:translate(-50%,3px)}}
    .fade-in{animation:fadeIn .5s ease forwards}
  </style>
</head>
<body class="h-full min-h-screen bg-gradient-to-br from-blue-100 to-blue-300 dark:from-slate-900 dark:to-slate-800 transition-colors duration-500">

  <main class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-lg bg-white/90 dark:bg-slate-800/90 backdrop-blur rounded-2xl shadow-2xl p-6 md:p-8">
      <h1 class="text-3xl font-extrabold text-slate-800 dark:text-white text-center">‚öñÔ∏è BMI Calculator</h1>
      <p class="text-center text-sm text-slate-600 dark:text-slate-300 mt-1">Body Mass Index (kg/m¬≤) ‚Äî metric units</p>

      <!-- Inputs -->
      <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-3">
        <label class="block md:col-span-2">
          <span class="text-sm font-medium text-slate-700 dark:text-slate-200">Name</span>
          <input id="name" type="text" maxlength="50"
                 class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
                 placeholder="e.g., John Doe" aria-label="Name">
        </label>
        <label class="block">
          <span class="text-sm font-medium text-slate-700 dark:text-slate-200">Height (cm)</span>
          <input id="height" type="number" min="50" max="300" step="0.1"
                 class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
                 placeholder="e.g., 170">
        </label>
        <label class="block">
          <span class="text-sm font-medium text-slate-700 dark:text-slate-200">Weight (kg)</span>
          <input id="weight" type="number" min="10" max="400" step="0.1"
                 class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-white px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
                 placeholder="e.g., 65">
        </label>
      </div>

      <!-- Actions -->
      <div class="mt-4 grid grid-cols-2 gap-3">
        <button id="calcBtn" class="py-2.5 rounded-xl bg-blue-600 hover:bg-blue-700 text-white font-semibold transition">Calculate</button>
        <button id="resetBtn" class="py-2.5 rounded-xl bg-slate-200 hover:bg-slate-300 dark:bg-slate-700 dark:hover:bg-slate-600 text-slate-800 dark:text-white font-semibold transition">Reset</button>
      </div>

      <!-- Result -->
      <div class="mt-5">
        <div id="result" class="text-lg font-semibold text-slate-800 dark:text-white opacity-0"></div>
        <div id="tip" class="text-sm text-slate-600 dark:text-slate-300 mt-1 opacity-0"></div>
      </div>

      <!-- BMI Bar -->
      <div class="mt-5">
        <div class="bmi-bar rounded-full">
          <div id="indicator" class="indicator" style="left:0%"></div>
        </div>
        <div class="flex justify-between text-[11px] text-slate-600 dark:text-slate-300 mt-1">
          <span>0</span><span>18.5</span><span>25</span><span>30</span><span>40</span>
        </div>
        <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Blue: Underweight ‚Ä¢ Green: Normal ‚Ä¢ Yellow: Overweight ‚Ä¢ Red: Obese</p>
      </div>

      <!-- History -->
      <section class="mt-7">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-bold text-slate-800 dark:text-white">üìú BMI History</h2>
          <div class="flex gap-2">
            <button id="csvBtn" class="px-3 py-1.5 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-semibold">Export CSV</button>
            <button id="pdfBtn" class="px-3 py-1.5 rounded-lg bg-purple-600 hover:bg-purple-700 text-white text-sm font-semibold">Export PDF</button>
          </div>
        </div>
        <ul id="history" class="mt-3 max-h-44 overflow-y-auto space-y-2"></ul>
        <div class="mt-2 flex gap-2">
          <button id="clearBtn" class="flex-1 py-2 rounded-xl bg-red-600 hover:bg-red-700 text-white font-semibold">üßπ Clear History</button>
        </div>
      </section>
    </div>
  </main>

  <script>
    const el = id => document.getElementById(id);
    const storage = { get:(k,d=null)=>{try{return JSON.parse(localStorage.getItem(k))??d;}catch{return d;}}, set:(k,v)=>localStorage.setItem(k,JSON.stringify(v)), del:k=>localStorage.removeItem(k) };

    const nameInput = el('name');
    const heightInput = el('height');
    const weightInput = el('weight');
    const calcBtn = el('calcBtn');
    const resetBtn = el('resetBtn');
    const resultBox = el('result');
    const tipBox = el('tip');
    const indicator = el('indicator');
    const historyList = el('history');
    const clearBtn = el('clearBtn');
    const csvBtn = el('csvBtn');
    const pdfBtn = el('pdfBtn');

    function getHistory(){return storage.get('bmiHistory',[]);}
    function setHistory(arr){storage.set('bmiHistory',arr);}
    function addHistory(entry){let arr=getHistory();arr.unshift(entry);if(arr.length>10)arr.pop();setHistory(arr);}
    function clearHistory(){setHistory([]);renderHistory();}
    clearBtn.addEventListener('click',clearHistory);

    function renderHistory(){
      historyList.innerHTML='';
      const arr=getHistory();
      if(arr.length===0){let li=document.createElement('li');li.className='text-sm text-slate-500 dark:text-slate-400';li.textContent='No history yet. Calculate your BMI to see it here.';historyList.appendChild(li);return;}
      arr.forEach((h,idx)=>{
        const li=document.createElement('li');
        li.className='p-3 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-sm flex items-start justify-between gap-3';
        li.innerHTML=`
          <div>
            <div class="font-semibold text-slate-800 dark:text-white">${h.name||'Anonymous'} ‚Äî BMI: ${h.bmi} <span class="font-normal">(${h.category})</span></div>
            <div class="text-[12px] text-slate-600 dark:text-slate-300">H: ${h.height} cm ‚Ä¢ W: ${h.weight} kg</div>
            <div class="text-[12px] text-slate-500 dark:text-slate-300">${h.datetime}</div>
          </div>
          <button aria-label="Delete entry ${idx+1}" class="shrink-0 px-2 py-1 rounded-lg bg-slate-200 hover:bg-slate-300 dark:bg-slate-600 dark:hover:bg-slate-500 text-[12px]" data-del="${idx}">Delete</button>
        `;
        historyList.appendChild(li);
      });
      historyList.querySelectorAll('[data-del]').forEach(btn=>{
        btn.addEventListener('click',()=>{let arr=getHistory();arr.splice(parseInt(btn.getAttribute('data-del')),1);setHistory(arr);renderHistory();});
      });
    }

    function categoryFor(bmi){if(bmi<18.5)return'Underweight üòï';if(bmi<25)return'Normal üôÇ';if(bmi<30)return'Overweight üòê';return'Obese üòü';}
    function tipFor(bmi){if(bmi<18.5)return'Increase calorie intake with nutrient-dense foods; consider strength training.';if(bmi<25)return'Great! Keep a balanced diet, regular activity, and quality sleep.';if(bmi<30)return'Add consistent exercise and mindful eating; track progress weekly.';return'Consult a healthcare professional for a tailored plan; start with gentle activity and diet changes.';}
    function percentForIndicator(bmi){return(Math.max(0,Math.min(40,bmi))/40)*100;}

    function showResult(text,tip){resultBox.classList.remove('fade-in');tipBox.classList.remove('fade-in');void resultBox.offsetWidth;resultBox.innerHTML=text;tipBox.textContent=tip?'üí° '+tip:'';resultBox.style.opacity=1;tipBox.style.opacity=tip?1:0;resultBox.classList.add('fade-in');tipBox.classList.add('fade-in');}

    function calculate(){
      const n=nameInput.value.trim()||'Anonymous';
      const h=parseFloat(heightInput.value),w=parseFloat(weightInput.value);
      storage.set('lastInputs',{n,h:heightInput.value,w:weightInput.value});
      if(!isFinite(h)||!isFinite(w)||h<=0||w<=0){showResult('‚ö†Ô∏è Please enter valid height & weight!','');indicator.style.left='0%';return;}
      const bmi=+(w/((h/100)**2)).toFixed(2);
      const cat=categoryFor(bmi),tip=tipFor(bmi),percent=percentForIndicator(bmi);
      showResult(`${n}, your BMI is <span class="font-bold">${bmi}</span> (${cat})`,tip);
      indicator.style.left=`calc(${percent}%)`;
      addHistory({name:n,bmi,category:cat,height:h,weight:w,datetime:new Date().toLocaleString()});
      renderHistory();
    }

    calcBtn.addEventListener('click',calculate);
    resetBtn.addEventListener('click',()=>{nameInput.value='';heightInput.value='';weightInput.value='';storage.set('lastInputs',{n:'',h:'',w:''});resultBox.textContent='';tipBox.textContent='';resultBox.style.opacity=0;tipBox.style.opacity=0;indicator.style.left='0%';});
    [heightInput,weightInput,nameInput].forEach(inp=>inp.addEventListener('keydown',e=>{if(e.key==='Enter')calculate();}));

    function exportCSV(){const rows=getHistory();if(rows.length===0){alert('No history to export!');return;}const headers=['Name','Date & Time','Height (cm)','Weight (kg)','BMI','Category'];const csvRows=[headers.join(',')].concat(rows.map(r=>[`"${r.name}"`||'Anonymous',`"${r.datetime}"`,r.height,r.weight,r.bmi,`"${r.category}"`].join(',')));const blob=new Blob([csvRows.join('\n')],{type:'text/csv;charset=utf-8;'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='bmi_history.csv';document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url);}
    csvBtn.addEventListener('click',exportCSV);

    function exportPDF(){const rows=getHistory();if(rows.length===0){alert('No history to export!');return;}const {jsPDF}=window.jspdf;const doc=new jsPDF({unit:'pt',format:'a4'});const margin=48;let y=margin;doc.setFont('helvetica','bold');doc.setFontSize(18);doc.text('BMI History Report',margin,y);y+=10;doc.setFont('helvetica','normal');doc.setFontSize(11);doc.text(`Generated: ${new Date().toLocaleString()}`,margin,y);y+=24;doc.setFont('helvetica','bold');doc.text('Name',margin,y);doc.text('Date & Time',margin+100,y);doc.text('Height',margin+250,y);doc.text('Weight',margin+310,y);doc.text('BMI',margin+370,y);doc.text('Category',margin+420,y);y+=14;doc.line(margin,y,545,y);y+=10;doc.setFont('helvetica','normal');rows.forEach(r=>{if(y>770){doc.addPage();y=margin;}doc.text(r.name||'Anonymous',margin,y);doc.text(r.datetime,margin+100,y);doc.text(String(r.height),margin+250,y);doc.text(String(r.weight),margin+310,y);doc.text(String(r.bmi),margin+370,y);doc.text(r.category.replace(/[\u{1F600}-\u{1F6FF}]/gu,''),margin+420,y,{maxWidth:120});y+=16;});doc.save('bmi_history.pdf');}
    pdfBtn.addEventListener('click',exportPDF);

    (function loadInputs(){const last=storage.get('lastInputs',null);if(last){if(last.n)nameInput.value=last.n;if(last.h)heightInput.value=last.h;if(last.w)weightInput.value=last.w;}})();
    renderHistory();
  </script>
</body>
</html>
